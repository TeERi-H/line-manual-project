# チケット #018: 運用マニュアル

## 概要
システム管理者向けの運用マニュアル作成

## 優先度
**Medium** - 運用開始前に必要

## 作成内容

## 1. システム概要

### システム構成
```
LINE公式アカウント
    ↓ Webhook
Vercel (Serverless Functions)
    ↓ API
Google Sheets (データベース)
Google Drive (メディア保存)
```

### 利用技術
- LINE Messaging API
- Vercel (Node.js)
- Google Sheets API
- Google Drive API

## 2. 日常運用

### マニュアル追加手順
1. Googleスプレッドシート「manuals」シートを開く
2. 新規行に以下を入力:
   - ID: M + 連番（例: M101）
   - カテゴリ情報
   - タイトル・本文
   - 権限設定
3. 画像がある場合:
   - Google Driveにアップロード
   - 共有リンクを取得
   - 画像URL列に貼り付け
4. 有効フラグを「TRUE」に設定

### マニュアル更新手順
1. 該当行を検索
2. 内容を修正
3. 更新日時を記録
4. 必要に応じて通知送信

### マニュアル削除手順
- 物理削除はしない
- 有効フラグを「FALSE」に変更

## 3. ユーザー管理

### 新規ユーザー承認
- 自動登録される
- 権限変更が必要な場合のみ手動更新

### 権限変更
1. 「users」シートを開く
2. 該当ユーザーの権限列を変更
   - 一般 → 総務
   - 一般 → 役職
3. 変更は即座に反映

### ユーザー無効化
1. 有効フラグを「FALSE」に変更
2. 以降のアクセスが拒否される

## 4. 問い合わせ対応

### 対応フロー
1. 管理者LINEに通知が届く
2. 「inquiries」シートで詳細確認
3. ステータスを「対応中」に変更
4. 対応実施
5. 対応内容を記録
6. ステータスを「完了」に変更

### エスカレーション基準
- 技術的な不具合 → 開発担当
- 業務内容の質問 → 各部門担当
- 要望 → 月次会議で検討

## 5. 監視項目

### 日次確認
- [ ] エラーログ確認（Vercel Dashboard）
- [ ] アクセスログ確認
- [ ] 未対応の問い合わせ確認

### 週次確認
- [ ] 利用統計確認
- [ ] よく検索されるキーワード分析
- [ ] 見つからなかったキーワード確認

### 月次作業
- [ ] アクセスログのアーカイブ
- [ ] Googleスプレッドシートのバックアップ
- [ ] 利用レポート作成

## 6. トラブルシューティング

### ケース1: Botが応答しない
```
確認事項:
1. Vercel Dashboardでエラー確認
2. LINE Developers ConsoleでWebhook状態確認
3. 環境変数の確認

対処:
- Vercelの再デプロイ
- Webhook URLの再設定
```

### ケース2: 検索結果が表示されない
```
確認事項:
1. Googleスプレッドシートのデータ確認
2. 権限設定の確認
3. 有効フラグの確認

対処:
- データの修正
- キャッシュクリア（再デプロイ）
```

### ケース3: 画像が表示されない
```
確認事項:
1. Google Driveの共有設定
2. URLの正確性
3. ファイルサイズ（10MB以下）

対処:
- 共有設定を「リンクを知っている全員」に変更
- URL再取得
```

## 7. バックアップとリカバリ

### バックアップ手順
```javascript
// Google Apps Scriptで自動バックアップ
function backupSpreadsheet() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const backupName = `Backup_${new Date().toISOString()}`;
  ss.copy(backupName);
}
```

### リカバリ手順
1. バックアップファイルを開く
2. 本番ファイルと差分確認
3. 必要なデータをコピー
4. 本番環境に反映

## 8. メンテナンス

### 定期メンテナンス
- 第1日曜日 深夜2:00-4:00
- 事前通知: 3日前
- 作業内容:
  - システムアップデート
  - データベース最適化
  - ログクリーンアップ

### 緊急メンテナンス
- 重大な不具合発生時
- 即座に実施
- メンテナンスモードに切り替え

### メンテナンスモード設定
1. 「settings」シートを開く
2. maintenance_mode を「TRUE」に変更
3. 全ユーザーにメンテナンス中メッセージが表示

## 9. KPI管理

### 測定指標
- MAU（月間アクティブユーザー数）
- 検索成功率
- 平均レスポンス時間
- 問い合わせ対応時間
- ユーザー満足度

### レポート作成
```
月次レポートテンプレート:
1. 利用状況サマリー
2. よく使われた機能TOP10
3. よく検索されたキーワードTOP20
4. 問い合わせ内容分析
5. 改善提案
```

## 10. 連絡先

### システム担当
- 開発: [担当者名]
- 運用: [担当者名]

### エスカレーション先
- 技術的問題: [メールアドレス]
- 業務的問題: [メールアドレス]

### 外部ベンダー
- Vercel サポート
- Google Cloud サポート
- LINE Partners

## 完了条件
- [ ] マニュアル作成完了
- [ ] 管理者への配布
- [ ] 運用訓練実施
- [ ] Q&A作成

## 備考
- マニュアルは定期的に更新
- 実運用での気づきを反映
- FAQ追加を継続的に実施